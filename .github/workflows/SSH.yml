name: SSH

on: workflow_dispatch

jobs:
  build:

    runs-on: ubuntu-latest
    timeout-minutes: 21600

    steps:
    - name: Download Frp
      run: wget https://github.com/AXAZXFAXA/RD/raw/main/frpc -O frpc
      
    - name: Make ini
      run: |
        echo [common] >> ./frpc.ini
        echo server_addr = 121.62.64.105 >> ./frpc.ini
        echo server_port = 7000 >> ./frpc.ini
        echo [ssh] >> ./frpc.ini
        echo type = tcp >> ./frpc.ini
        echo local_ip = 127.0.0.1 >> ./frpc.ini
        echo local_port = 22 >> ./frpc.ini
        echo remote_port = 2222 >> ./frpc.ini
        echo [http80] >> ./frpc.ini
        echo type = tcp >> ./frpc.ini
        echo local_ip = 127.0.0.1 >> ./frpc.ini
        echo local_port = 80 >> ./frpc.ini
        echo remote_port = 80 >> ./frpc.ini
        echo [http8888] >> ./frpc.ini
        echo type = tcp >> ./frpc.ini
        echo local_ip = 127.0.0.1 >> ./frpc.ini
        echo local_port = 8888 >> ./frpc.ini
        echo remote_port = 8888 >> ./frpc.ini

    - name : Make Password txt
      run : |
        echo runneradmin >> ./psw.txt
        echo runneradmin >> ./psw.txt
        
    - name : Change Password
      run : sudo passwd runner < ./psw.txt
      
    - name: My Passwd
      run: sudo passwd -S runner
      
    - name: Chmod
      run: sudo chmod 777 ./frpc

    - name: Start
      run: ./frpc -c frpc.ini

    - name: Connect to your RDP IP:127.0.0.1:2222
      run: Ping 127.0.0.1
